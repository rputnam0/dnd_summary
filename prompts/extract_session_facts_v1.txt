You are extracting structured session facts from a D&D transcript.

Return ONLY valid JSON matching this schema:
{{
  "mentions": [
    {{
      "text": "string",
      "entity_type": "character|location|item|faction|monster|deity|organization|other",
      "description": "string or null",
      "evidence": [{{"utterance_id": "string", "char_start": 0, "char_end": 1, "kind": "mention", "confidence": 0.0}}],
      "confidence": 0.0
    }}
  ],
  "scenes": [
    {{
      "title": "string or null",
      "start_ms": 0,
      "end_ms": 0,
      "summary": "string",
      "location": "string or null",
      "participants": ["string"],
      "evidence": [{{"utterance_id": "string", "char_start": 0, "char_end": 1, "kind": "support", "confidence": 0.0}}]
    }}
  ],
  "events": [
    {{
      "event_type": "combat|social|travel|discovery|loot|economy|relationship|thread_update|rules|generic",
      "start_ms": 0,
      "end_ms": 0,
      "summary": "string",
      "entities": ["string"],
      "evidence": [{{"utterance_id": "string", "char_start": 0, "char_end": 1, "kind": "support", "confidence": 0.0}}],
      "confidence": 0.0
    }}
  ],
  "threads": [
    {{
      "title": "string",
      "kind": "quest|mystery|personal_arc|faction_arc|other",
      "status": "proposed|active|blocked|completed|failed|abandoned",
      "summary": "string or null",
      "updates": [
        {{
          "update_type": "string",
          "note": "string",
          "related_event_indexes": [0],
          "evidence": [{{"utterance_id": "string", "char_start": 0, "char_end": 1, "kind": "support", "confidence": 0.0}}]
        }}
      ],
      "evidence": [{{"utterance_id": "string", "char_start": 0, "char_end": 1, "kind": "support", "confidence": 0.0}}],
      "confidence": 0.0
    }}
  ],
  "quotes": [
    {{
      "utterance_id": "string",
      "char_start": 0,
      "char_end": 1,
      "speaker": "string or null",
      "note": "string or null",
      "clean_text": "string or null"
    }}
  ]
}}

Rules:
- Use character names (in-world), not player names, when referring to PCs.
- Prefer the character map below when naming PCs or speakers.
- Use ONLY utterance_id values that appear in the transcript below.
- char_start/char_end must be offsets into the referenced utterance text (0-based, within the utterance text only).
- char_end must be > char_start and within the utterance text length (never 0,0).
- Each evidence entry must include char_start/char_end and should point to the smallest substring that supports the claim.
- Use related_event_indexes to point to the relevant item(s) in the events list (0-based).
- Quotes must isolate the in-character line only (exclude narration like "she goes", "he says", "they say").
- If a quote needs light cleanup for readability, include a clean_text version while keeping char_start/char_end grounded in the utterance.
- Do not skip interesting/funny quotes because of minor transcription noise; use clean_text instead.
- Every mention/scene/event/thread/update MUST include at least one evidence span with char_start and char_end populated.
- If you cannot find a perfect supporting span, use the best approximate span and lower confidence; do NOT leave evidence empty.
- If you are unsure, lower confidence instead of inventing facts.
- Prefer completeness over brevity; include NPCs, locations, items, factions, relationships, money, and combat outcomes.

Validation checklist before output:
- No evidence list is empty.
- Every evidence entry includes char_start and char_end.

Character Map (participant -> character, JSON):
{character_map}

Transcript (each line includes the utterance_id):
{transcript}
